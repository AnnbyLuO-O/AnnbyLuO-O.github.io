<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>給 (Message + Typewriter - Stable)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    @font-face { font-family: 'Cubic 11'; src: url('https://cdn.jsdelivr.net/npm/man-tout-font@1.0.1/font/MTC.woff2') format('woff2'); }
    body { font-family: 'Cubic 11', 'Press Start 2P', cursive; background-color: #74b9ff; color: #222; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; image-rendering: pixelated; }
    .container { position: relative; text-align: center; background-color: #fefefe; padding: 30px; border-radius: 0; border: 4px solid #222; box-shadow: 8px 8px 0px #222; width: 90%; max-width: 450px; }
    #result-container { display: none; }
    h1 { font-size: 22px; line-height: 1.5; }
    p { line-height: 1.5; font-size: 14px; }
    input[type="text"] { width: 80%; padding: 10px; margin-bottom: 15px; border: 2px solid #222; border-radius: 0; font-size: 12px; font-family: 'Cubic 11', 'Press Start 2P', cursive; background-color: #fefefe; }
    input::placeholder { color: #888; font-size: 9px; }
    button { background-color: #f39c12; color: #ffffff; padding: 12px 20px; border: 2px solid #222; border-radius: 0; cursor: pointer; font-size: 12px; font-family: 'Cubic 11', 'Press Start 2P', cursive; transition: none; }
    button:hover, button:active { background-color: #e67e22; color: #ffff00; }

    /* Message Area: 固定高度 + 超出可滾動 */
    #code-message-area {
      background-color: #2d2d2d; color: #00ff41;
      font-family: 'Courier New', Courier, monospace; font-size: 14px;
      text-align: left; padding: 15px; border: 2px solid #222;
      min-height: 100px;
      max-height: min(40vh, 260px);   /* 固定顯示高度（隨螢幕調整） */
      overflow-y: auto;               /* 超出時顯示垂直捲軸 */
      overflow-x: hidden;             /* 避免橫向捲動 */
      line-height: 1.6; white-space: pre-wrap;
      word-break: break-word;         /* 長字/URL 斷行 */
      margin-bottom: 15px;
      position: relative;             /* 供游標定位 */
    }

    /* 可選：美化捲軸（僅 WebKit） */
    #code-message-area::-webkit-scrollbar { width: 10px; }
    #code-message-area::-webkit-scrollbar-track { background: #1f1f1f; }
    #code-message-area::-webkit-scrollbar-thumb { background: #555; border-radius: 6px; }
    #code-message-area::-webkit-scrollbar-thumb:hover { background: #777; }

    /* 打字游標 */
    .typing-cursor {
      display: inline-block;
      background-color: #00ff41;
      width: 8px;
      height: 1.1em;
      margin-left: 1px;
      vertical-align: baseline;
      animation: blink 1s step-end infinite;
    }
    @keyframes blink {
      from, to { background-color: transparent; }
      50% { background-color: #00ff41; }
    }

    /* Modal */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 1000; }
    .modal-content { background-color: #fefefe; padding: 25px; border-radius: 0; border: 4px solid #222; text-align: center; box-shadow: 8px 8px 0px #222; width: 90%; max-width: 400px; }
    .modal-content p { font-size: 14px; margin-bottom: 25px; line-height: 1.5; }
    .modal-buttons button { padding: 15px 20px; display: block; width: 100%; margin: 0 0 10px 0; font-size: 10px; }
    .modal-buttons button:last-child { margin-bottom: 0; }
    #confirm-btn { background-color: #4a90e2; }
    #confirm-btn:hover, #confirm-btn:active { background-color: #357abd; color: #ffff00; }
    #cancel-btn { background-color: #f39c12; }
    #cancel-btn:hover, #cancel-btn:active { background-color: #e67e22; color: #ffff00; }

    @media (max-width: 500px) {
      .container { width: 85%; padding: 15px; }
      h1 { font-size: 18px; }
      button { padding: 10px 15px; font-size: 11px; }
      #code-message-area { font-size: 12px; min-height: 80px; }
      .modal-content { padding: 20px; max-width: 90%; }
    }
  </style>
</head>
<body>
  <div id="input-container" class="container">
    <h1>For uuu</h1>
    <p>Please enter your name</p>
    <input type="text" id="name-input" placeholder="e.g.Danny, Capitalize the first letter">
    <button onclick="showMessage()">see message</button>
  </div>

  <div id="result-container" class="container">
    <p>Message for you:</p>
    <pre id="code-message-area"></pre>
    <button onclick="resetToStart()">Try another name</button>
  </div>

  <div id="modal-overlay" class="modal-overlay">
    <div class="modal-content">
      <p id="confirmation-text">This is a confirmation message</p>
      <div class="modal-buttons">
        <button id="confirm-btn" onclick="confirmName()">I've checked it out.</button>
        <button id="cancel-btn" onclick="cancelConfirmation()">My bad. Let me start over.</button>
      </div>
    </div>
  </div>

  <script defer>
    // --- Variables ---
    const messages = {
      'Joy': '嗨阿狗，今天大便了嗎 ?',
      'Gina': '居那你的女朋友呢 ?',
      'Michelle': '不想上班就回家吧 老吳會養你',
      'Shelley': '雪莉，那個頭像是你嗎 ?',
      'Melody': '辣地好辣 !',
      'Danny': '丹尼期中考加油,被當掉我會笑妳,兔子警官會逮捕妳!丹尼期中考加油,被當掉我會笑妳,兔子警官會逮捕妳!丹尼期中考加油,被當掉我會笑妳,兔子警官會逮捕妳!丹尼期中考加油,被當掉我會笑妳,兔子警官會逮捕妳!丹尼期中考加油,被當掉我會笑妳,兔子警官會逮捕妳!丹尼期中考加油,被當掉我會笑妳,兔子警官會逮捕妳!丹尼期中考加油,被當掉我會笑妳,兔子警官會逮捕妳!丹尼期中考加油,被當掉我會笑妳,兔子警官會逮捕妳!丹尼期中考加油,被當掉我會笑妳,兔子警官會逮捕妳!丹尼期中考加油,被當掉我會笑妳,兔子警官會逮捕妳!丹尼期中考加油,被當掉我會笑妳,兔子警官會逮捕妳!丹尼期中考加油,被當掉我會笑妳,兔子警官會逮捕妳!丹尼期中考加油,被當掉我會笑妳,兔子警官會逮捕妳!丹尼期中考加油,被當掉我會笑妳,兔子警官會逮捕妳!丹尼期中考加油,被當掉我會笑妳,兔子警官會逮捕妳!'
    };

    let currentName = '';
    let inputContainer, nameInput, modalOverlay, confirmationText, resultContainer, codeMessageArea;
    let typingInterval = null;

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
      try {
        inputContainer = document.getElementById('input-container');
        nameInput = document.getElementById('name-input');
        modalOverlay = document.getElementById('modal-overlay');
        confirmationText = document.getElementById('confirmation-text');
        resultContainer = document.getElementById('result-container');
        codeMessageArea = document.getElementById('code-message-area');

        if (!inputContainer || !nameInput || !modalOverlay || !confirmationText || !resultContainer || !codeMessageArea) {
          throw new Error("Critical UI elements missing!");
        }
      } catch (error) {
        document.body.innerHTML = `<p style='color:red;'>Error: Init failed. ${error.message}</p>`;
      }
    });

    // --- Screen Switching Functions ---
    function showMessage() {
      if (!nameInput || !confirmationText || !modalOverlay) return;
      currentName = nameInput.value;
      if (currentName.trim() === '') { alert('Please enter your name first！'); return; }
      confirmationText.innerText = `Are you sure you are "${currentName}" ?`;
      modalOverlay.style.display = 'flex';
    }

    function cancelConfirmation() {
      if (modalOverlay) modalOverlay.style.display = 'none';
    }

    // --- Confirm & Typewriter ---
    function confirmName() {
      if (!codeMessageArea || !inputContainer || !resultContainer || !modalOverlay) {
        alert("Error: Cannot display message.");
        return;
      }
      cancelConfirmation(); // Close modal
      const messageToShow = (currentName in messages) ? messages[currentName] : `Who are you ${currentName}? No message for you.`;

      // Start typewriter
      codeMessageArea.innerHTML = '';
      typeMessage(messageToShow, codeMessageArea);

      inputContainer.style.display = 'none';
      resultContainer.style.display = 'block';
    }

    function typeMessage(message, element) {
      if (typingInterval) { clearInterval(typingInterval); typingInterval = null; }

      let index = 0;
      element.innerHTML = '<span class="typing-cursor"></span>';

      typingInterval = setInterval(() => {
        if (index < message.length) {
          const cursorSpan = element.querySelector('.typing-cursor');
          const charNode = document.createTextNode(message[index]);

          if (cursorSpan) {
            element.insertBefore(charNode, cursorSpan);
          } else {
            element.appendChild(charNode);
          }

          /* 讓滾動條跟著游標往下（關鍵新增） */
          element.scrollTop = element.scrollHeight;

          index++;
        } else {
          clearInterval(typingInterval);
          typingInterval = null;
          const cursorSpan = element.querySelector('.typing-cursor');
          if (cursorSpan) cursorSpan.remove();
        }
      }, 80);
    }

    // --- Reset ---
    function resetToStart() {
      if (typingInterval) {
        clearInterval(typingInterval);
        typingInterval = null;
      }
      if (resultContainer) resultContainer.style.display = 'none';
      if (modalOverlay) modalOverlay.style.display = 'none';
      if (inputContainer) inputContainer.style.display = 'block';
      if (nameInput) nameInput.value = '';
      if (codeMessageArea) codeMessageArea.innerHTML = '';
    }
  </script>
</body>
</html>
